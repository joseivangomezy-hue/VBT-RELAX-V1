<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VBT and Relax</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .custom-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        input[type="range"] {
            accent-color: #3b82f6;
        }
        .editable-input {
            background: transparent;
            border-bottom: 1px dashed #cbd5e1;
            width: 60px;
            text-align: center;
        }
        .editable-input:focus {
            outline: none;
            border-bottom: 2px solid #3b82f6;
            background: #f8fafc;
        }
        .tab-active {
            background-color: white;
            color: #2563eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900 font-sans">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <header class="mb-6 text-center">
            <h1 class="text-3xl font-bold text-slate-800 tracking-tight italic">VBT and Relax</h1>
            <p class="text-slate-500 mt-2">Tus datos se guardan localmente en este dispositivo</p>
        </header>

        <main class="space-y-6">
            
            <!-- SECCIÓN SUPERIOR: PESTAÑAS Y CONFIGURACIÓN -->
            <section class="bg-white p-2 rounded-2xl custom-shadow border border-slate-100">
                <!-- Pestañas de Ejercicios -->
                <div class="flex flex-wrap gap-1 bg-slate-100 p-1 rounded-xl mb-4">
                    <button onclick="switchExercise('bench')" id="tab-bench" class="flex-1 py-2 px-4 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-slate-700">Press Banca</button>
                    <button onclick="switchExercise('squat')" id="tab-squat" class="flex-1 py-2 px-4 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-slate-700">Sentadilla</button>
                    <button onclick="switchExercise('deadlift')" id="tab-deadlift" class="flex-1 py-2 px-4 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-slate-700">Peso Muerto</button>
                    <button onclick="switchExercise('pullup')" id="tab-pullup" class="flex-1 py-2 px-4 rounded-lg text-sm font-bold transition-all text-slate-500 hover:text-slate-700">Dominadas</button>
                </div>

                <div class="px-4 pb-4 flex flex-col md:flex-row justify-between items-center gap-6">
                    <!-- Info Velocidad 1RM -->
                    <div class="flex items-center gap-3 bg-blue-50 px-4 py-2 rounded-xl border border-blue-100 shrink-0">
                        <div class="text-blue-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" /></svg>
                        </div>
                        <div>
                            <p class="text-[10px] font-black text-blue-400 uppercase leading-none">V-1RM Referencia</p>
                            <p id="v1rmDisplay" class="text-lg font-mono font-bold text-blue-700 leading-tight">0.17 m/s</p>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-4 flex-grow items-end w-full">
                        <div class="w-24">
                            <label class="block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider">Video FPS</label>
                            <input type="number" id="fpsInput" value="30" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex-grow">
                            <input type="file" id="videoInput" accept="video/*" class="hidden">
                            <button onclick="document.getElementById('videoInput').click()" class="w-full p-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition text-sm font-bold shadow-sm flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                                Cargar Vídeo
                            </button>
                        </div>
                        <div class="flex-grow md:flex-grow-0">
                            <button onclick="clearCurrentExercise()" class="w-full p-3 bg-rose-50 text-rose-600 rounded-xl hover:bg-rose-100 transition text-xs font-bold border border-rose-100">
                                Borrar Datos
                            </button>
                        </div>
                    </div>
                    <div class="text-right shrink-0">
                        <span id="fpsStatus" class="inline-block text-[10px] font-black px-3 py-1.5 rounded-full bg-slate-100 text-slate-500 uppercase">Sin Vídeo</span>
                    </div>
                </div>
            </section>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <!-- SECCIÓN IZQUIERDA: VIDEO Y MEDICIÓN -->
                <div class="lg:col-span-7 space-y-6">
                    <div class="bg-black rounded-2xl overflow-hidden shadow-2xl aspect-video relative group flex items-center justify-center border-4 border-slate-200">
                        <video id="videoPlayer" class="w-full h-full object-contain" playsinline muted></video>
                        <div class="absolute top-4 left-4 bg-black/50 backdrop-blur-md px-3 py-1 rounded-full text-white text-xs pointer-events-none flex gap-3 border border-white/10">
                            <span>Frame: <b id="currentFrameDisplay">0</b></span>
                            <span class="border-l border-white/20 pl-3">Tiempo: <b id="currentTimeDisplay">0.000</b>s</span>
                        </div>
                        <div id="processingOverlay" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center text-white hidden">
                            <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                            <p class="text-lg font-medium">Analizando FPS...</p>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl custom-shadow border border-slate-100">
                        <div class="flex flex-wrap gap-4 items-center justify-between mb-6">
                            <div class="flex gap-2">
                                <button onclick="stepFrame(-1)" class="p-3 bg-slate-100 rounded-lg hover:bg-slate-200 text-slate-700 transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832L10 11.202V14a1 1 0 001.555.832l6-4a1 1 0 000-1.664l-6-4A1 1 0 0010 6v2.798l-5.445-3.63z" /></svg>
                                </button>
                                <button onclick="stepFrame(1)" class="p-3 bg-slate-100 rounded-lg hover:bg-slate-200 text-slate-700 transition">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M15.445 14.832A1 1 0 0017 14V6a1 1 0 00-1.555-.832l-6 4a1 1 0 000-1.664l6 4z" /></svg>
                                </button>
                            </div>
                            <div class="flex-grow px-4">
                                <input type="range" id="frameSlider" value="0" min="0" step="1" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="markFrame('start')" class="py-3 px-4 bg-emerald-50 text-emerald-700 border border-emerald-100 rounded-xl hover:bg-emerald-100 transition flex flex-col items-center">
                                <span class="text-[10px] font-bold uppercase opacity-60">Inicio</span>
                                <span id="startFrameText" class="text-lg font-mono font-bold">--</span>
                            </button>
                            <button onclick="markFrame('end')" class="py-3 px-4 bg-rose-50 text-rose-700 border border-rose-100 rounded-xl hover:bg-rose-100 transition flex flex-col items-center">
                                <span class="text-[10px] font-bold uppercase opacity-60">Final</span>
                                <span id="endFrameText" class="text-lg font-mono font-bold">--</span>
                            </button>
                        </div>

                        <div class="mt-6 flex gap-4">
                            <div class="flex-1">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Carga (kg)</label>
                                <input type="number" id="currentLoadInput" placeholder="Ej: 60" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex-1">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Recorrido (cm)</label>
                                <input type="number" id="distanceInput" value="45" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <button onclick="addEntry()" class="w-full mt-4 py-3 bg-slate-800 text-white rounded-xl hover:bg-slate-700 transition font-bold shadow-md">
                            Registrar Velocidad
                        </button>
                    </div>
                </div>

                <!-- SECCIÓN DERECHA: RESULTADOS -->
                <div class="lg:col-span-5 space-y-6">
                    <section class="bg-white p-6 rounded-2xl custom-shadow border border-slate-100">
                        <h2 class="text-sm font-bold text-slate-400 uppercase mb-4 tracking-widest" id="exerciseTitle">Test Progresivo</h2>
                        <div class="space-y-2 mb-4" id="entriesList">
                            <p class="text-slate-400 text-sm italic py-4 text-center">No hay cargas registradas</p>
                        </div>
                        
                        <div id="rmResultContainer" class="p-6 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-2xl text-white hidden shadow-lg">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-xs font-bold uppercase opacity-80 mb-1">Estimación 1RM</p>
                                    <div class="flex items-baseline gap-2">
                                        <span id="rmValue" class="text-5xl font-black">0.0</span>
                                        <span class="text-xl font-bold">kg</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-[10px] font-bold uppercase opacity-80">Precisión (R²)</p>
                                    <p id="r2Value" class="text-xl font-mono font-bold">0.000</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- PLANIFICADOR: RPE 5-10 -->
                    <section id="plannerSection" class="bg-white p-6 rounded-2xl custom-shadow border border-slate-100 hidden">
                        <h2 class="text-sm font-bold text-slate-400 uppercase mb-4 tracking-widest flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
                            Planificador de Carga
                        </h2>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1 uppercase tracking-tight">Reps</label>
                                <input type="number" id="planReps" value="5" min="1" max="12" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-1 uppercase tracking-tight">RPE</label>
                                <select id="planRPE" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="10">10 (Fallo)</option>
                                    <option value="9.5">9.5</option>
                                    <option value="9" selected>9</option>
                                    <option value="8.5">8.5</option>
                                    <option value="8">8</option>
                                    <option value="7.5">7.5</option>
                                    <option value="7">7</option>
                                    <option value="6.5">6.5</option>
                                    <option value="6">6</option>
                                    <option value="5.5">5.5</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                        </div>
                        <div class="p-4 bg-indigo-50 rounded-xl border border-indigo-100 text-center">
                            <p class="text-xs font-bold text-indigo-400 uppercase mb-1 leading-none tracking-wider">Carga Sugerida</p>
                            <div class="flex justify-center items-baseline gap-2 text-indigo-700">
                                <span id="suggestedWeight" class="text-4xl font-black">0.0</span>
                                <span class="text-lg font-bold">kg</span>
                            </div>
                            <p id="intensityInfo" class="text-[10px] text-indigo-400 mt-2 font-medium uppercase"></p>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Velocidades medias propulsivas para 1RM según literatura científica
        const V1RM = { bench: 0.17, squat: 0.30, deadlift: 0.15, pullup: 0.22 };
        const EX_NAMES = { bench: "Press Banca", squat: "Sentadilla", deadlift: "Peso Muerto", pullup: "Dominadas" };
        
        // Tabla RPE expandida para incluir hasta RPE 5
        const RPE_CHART = {
            1: { 10: 100, 9.5: 98, 9: 96, 8.5: 94, 8: 92, 7.5: 91, 7: 89, 6.5: 87, 6: 85, 5.5: 83, 5: 81 },
            2: { 10: 96, 9.5: 94, 9: 92, 8.5: 91, 8: 89, 7.5: 87, 7: 85, 6.5: 83, 6: 81, 5.5: 79, 5: 77 },
            3: { 10: 92, 9.5: 91, 9: 89, 8.5: 87, 8: 85, 7.5: 84, 7: 82, 6.5: 80, 6: 78, 5.5: 76, 5: 74 },
            4: { 10: 89, 9.5: 87, 9: 85, 8.5: 84, 8: 82, 7.5: 80, 7: 79, 6.5: 77, 6: 75, 5.5: 73, 5: 71 },
            5: { 10: 86, 9.5: 84, 9: 82, 8.5: 80, 8: 79, 7.5: 77, 7: 76, 6.5: 74, 6: 72, 5.5: 70, 5: 68 },
            6: { 10: 83, 9.5: 81, 9: 79, 8.5: 78, 8: 76, 7.5: 74, 7: 73, 6.5: 71, 6: 69, 5.5: 67, 5: 65 },
            7: { 10: 80, 9.5: 78, 9: 76, 8.5: 75, 8: 73, 7.5: 71, 7: 70, 6.5: 68, 6: 66, 5.5: 64, 5: 62 },
            8: { 10: 77, 9.5: 75, 9: 73, 8.5: 72, 8: 70, 7.5: 68, 7: 67, 6.5: 65, 6: 63, 5.5: 61, 5: 59 },
            9: { 10: 75, 9.5: 73, 9: 71, 8.5: 69, 8: 67, 7.5: 65, 7: 64, 6.5: 62, 6: 60, 5.5: 58, 5: 56 },
            10: { 10: 72, 9.5: 70, 9: 68, 8.5: 66, 8: 64, 7.5: 63, 7: 61, 6.5: 59, 6: 57, 5.5: 55, 5: 53 },
            11: { 10: 69, 9.5: 67, 9: 65, 8.5: 63, 8: 62, 7.5: 60, 7: 59, 6.5: 57, 6: 55, 5.5: 53, 5: 51 },
            12: { 10: 67, 9.5: 65, 9: 63, 8.5: 61, 8: 60, 7.5: 58, 7: 57, 6.5: 55, 6: 53, 5.5: 51, 5: 49 }
        };

        const videoInput = document.getElementById('videoInput');
        const videoPlayer = document.getElementById('videoPlayer');
        const frameSlider = document.getElementById('frameSlider');
        const fpsInput = document.getElementById('fpsInput');
        const entriesList = document.getElementById('entriesList');
        const plannerSection = document.getElementById('plannerSection');
        const suggestedWeight = document.getElementById('suggestedWeight');
        const v1rmDisplay = document.getElementById('v1rmDisplay');
        
        let currentExercise = 'bench';
        let allData = JSON.parse(localStorage.getItem('vbt_data')) || { bench: [], squat: [], deadlift: [], pullup: [] };
        let startFrame = null, endFrame = null, estimated1RM = 0;

        // Inicializar UI
        window.onload = () => switchExercise(currentExercise);

        function switchExercise(ex) {
            currentExercise = ex;
            // Actualizar pestañas
            Object.keys(EX_NAMES).forEach(key => {
                document.getElementById(`tab-${key}`).classList.toggle('tab-active', key === ex);
            });
            // Mostrar V1RM Visual
            v1rmDisplay.textContent = `${V1RM[ex].toFixed(2)} m/s`;
            document.getElementById('exerciseTitle').textContent = `Test: ${EX_NAMES[ex]}`;
            updateUI();
        }

        function saveData() {
            localStorage.setItem('vbt_data', JSON.stringify(allData));
        }

        videoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            videoPlayer.src = URL.createObjectURL(file);
            document.getElementById('processingOverlay').classList.remove('hidden');
            videoPlayer.onloadedmetadata = async () => {
                const det = await detectFPS(videoPlayer);
                fpsInput.value = Math.round(det);
                document.getElementById('fpsStatus').textContent = Math.round(det) + " FPS";
                frameSlider.max = Math.floor(videoPlayer.duration * det);
                document.getElementById('processingOverlay').classList.add('hidden');
            };
        });

        async function detectFPS(v) {
            return new Promise(res => {
                if (!v.requestVideoFrameCallback) return res(30);
                let f = [];
                const cb = (_, m) => {
                    if (m.mediaTime !== undefined) f.push(m.mediaTime);
                    if (f.length < 30) v.requestVideoFrameCallback(cb);
                    else {
                        v.pause();
                        let d = f.slice(1).map((t, i) => t - f[i]).filter(x => x > 0);
                        res(d.length ? 1 / (d.reduce((a, b) => a + b, 0) / d.length) : 30);
                    }
                };
                v.play().then(() => v.requestVideoFrameCallback(cb)).catch(() => res(30));
            });
        }

        videoPlayer.addEventListener('timeupdate', () => {
            const fps = parseFloat(fpsInput.value) || 30;
            const f = Math.round(videoPlayer.currentTime * fps);
            document.getElementById('currentFrameDisplay').textContent = f;
            document.getElementById('currentTimeDisplay').textContent = videoPlayer.currentTime.toFixed(3);
            frameSlider.value = f;
        });

        frameSlider.addEventListener('input', () => videoPlayer.currentTime = frameSlider.value / (parseFloat(fpsInput.value) || 30));

        function stepFrame(d) { videoPlayer.currentTime += d / (parseFloat(fpsInput.value) || 30); }

        function markFrame(t) {
            const f = Math.round(videoPlayer.currentTime * (parseFloat(fpsInput.value) || 30));
            if (t === 'start') { startFrame = f; document.getElementById('startFrameText').textContent = f; }
            else { endFrame = f; document.getElementById('endFrameText').textContent = f; }
        }

        function addEntry() {
            if (startFrame === null || endFrame === null) return;
            const load = parseFloat(document.getElementById('currentLoadInput').value);
            if (isNaN(load) || load <= 0) return;
            const vel = (parseFloat(document.getElementById('distanceInput').value) / 100) / ((endFrame - startFrame) / (parseFloat(fpsInput.value) || 30));
            
            allData[currentExercise].push({ load, velocity: vel });
            saveData();
            updateUI();
            
            startFrame = endFrame = null;
            document.getElementById('startFrameText').textContent = document.getElementById('endFrameText').textContent = "--";
        }

        function updateUI() {
            const entries = allData[currentExercise];
            if (!entries.length) { 
                entriesList.innerHTML = `<p class="text-slate-400 text-sm italic py-4 text-center">Sin registros para ${EX_NAMES[currentExercise]}</p>`;
                document.getElementById('rmResultContainer').classList.add('hidden');
                plannerSection.classList.add('hidden');
                return; 
            }
            
            entriesList.innerHTML = entries.map((e, i) => `
                <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <div class="flex flex-col">
                        <span class="text-[9px] font-black text-blue-500 uppercase">Serie ${i+1}</span>
                        <div class="flex items-center gap-1">
                            <input type="number" step="0.5" value="${e.load}" onchange="editEntry(${i}, 'load', this.value)" class="editable-input font-bold text-slate-700">
                            <span class="text-xs font-bold text-slate-400">kg</span>
                        </div>
                    </div>
                    <div class="flex flex-col text-right">
                        <span class="text-[9px] font-black text-slate-400 uppercase">m/s</span>
                        <input type="number" step="0.01" value="${e.velocity.toFixed(2)}" onchange="editEntry(${i}, 'velocity', this.value)" class="editable-input font-mono font-bold text-slate-800">
                    </div>
                    <button onclick="removeEntry(${i})" class="text-rose-300 hover:text-rose-500 ml-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                    </button>
                </div>`).join('');
                
            if (entries.length >= 2) calcRM();
            else {
                document.getElementById('rmResultContainer').classList.add('hidden');
                plannerSection.classList.add('hidden');
            }
        }

        function editEntry(i, field, val) {
            allData[currentExercise][i][field] = parseFloat(val);
            saveData();
            updateUI();
        }

        function removeEntry(i) {
            allData[currentExercise].splice(i, 1);
            saveData();
            updateUI();
        }

        function clearCurrentExercise() {
            if(confirm(`¿Borrar todos los datos de ${EX_NAMES[currentExercise]}?`)) {
                allData[currentExercise] = [];
                saveData();
                updateUI();
            }
        }

        function calcRM() {
            const entries = allData[currentExercise];
            const x = entries.map(e => e.velocity), y = entries.map(e => e.load), n = x.length;
            const sX = x.reduce((a, b) => a + b, 0), sY = y.reduce((a, b) => a + b, 0);
            const sXY = x.reduce((p, c, i) => p + (c * y[i]), 0), sXX = x.reduce((a, b) => a + (b * b), 0);
            const den = (n * sXX - sX * sX);
            if (den === 0) return;
            const slope = (n * sXY - sX * sY) / den, intercept = (sY - slope * sX) / n;
            const yM = sY / n, ssT = y.reduce((a, v) => a + Math.pow(v - yM, 2), 0);
            const ssR = y.reduce((a, v, i) => a + Math.pow(v - (slope * x[i] + intercept), 2), 0);
            const r2 = ssT === 0 ? 1 : 1 - (ssR / ssT);

            estimated1RM = slope * V1RM[currentExercise] + intercept;
            document.getElementById('rmValue').textContent = estimated1RM.toFixed(1);
            document.getElementById('r2Value').textContent = r2.toFixed(3);
            document.getElementById('rmResultContainer').classList.remove('hidden');
            plannerSection.classList.remove('hidden');
            updatePlan();
        }

        function updatePlan() {
            const p = RPE_CHART[document.getElementById('planReps').value]?.[document.getElementById('planRPE').value] || 0;
            if (p > 0) {
                suggestedWeight.textContent = (estimated1RM * (p / 100)).toFixed(1);
                document.getElementById('intensityInfo').textContent = `Intensidad: ${p}% del 1RM`;
            }
        }

        document.getElementById('planReps').addEventListener('input', updatePlan);
        document.getElementById('planRPE').addEventListener('change', updatePlan);
    </script>
</body>
</html>
